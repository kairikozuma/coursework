%==========================
%  Name:		hw4_2.m
%
%  Author:		Kairi Kozuma
%
%==========================

% Q matrix
Q = [10.4300000000000,3.51500000000000,7.13300000000000,1,0,0,0,0,-7.64000000000000,-2.57500000000000,-5.22500000000000,-0.732500000000000;0,0,0,0,10.4300000000000,3.51500000000000,7.13300000000000,1,2.68600000000000,0.905100000000000,1.83700000000000,0.257500000000000;10.1300000000000,3.37800000000000,8.68900000000000,1,0,0,0,0,-5.57200000000000,-1.85800000000000,-4.77900000000000,-0.550000000000000;0,0,0,0,10.1300000000000,3.37800000000000,8.68900000000000,1,5.39400000000000,1.79900000000000,4.62700000000000,0.532500000000000;10.0100000000000,6.80800000000000,7.26400000000000,1,0,0,0,0,-0.825800000000000,-0.561700000000000,-0.599300000000000,-0.0825000000000000;0,0,0,0,10.0100000000000,6.80800000000000,7.26400000000000,1,-0.525500000000000,-0.357400000000000,-0.381400000000000,-0.0525000000000000;9.66900000000000,8.82400000000000,10.8200000000000,1,0,0,0,0,5.70500000000000,5.20600000000000,6.38400000000000,0.590000000000000;0,0,0,0,9.66900000000000,8.82400000000000,10.8200000000000,1,3.21500000000000,2.93400000000000,3.59800000000000,0.332500000000000;11.4000000000000,8.42000000000000,8.97500000000000,1,0,0,0,0,2.90700000000000,2.14700000000000,2.28900000000000,0.255000000000000;0,0,0,0,11.4000000000000,8.42000000000000,8.97500000000000,1,-0.199500000000000,-0.147300000000000,-0.157100000000000,-0.0175000000000000;13.2400000000000,6.54900000000000,5.91800000000000,1,0,0,0,0,-3.57500000000000,-1.76800000000000,-1.59800000000000,-0.270000000000000;0,0,0,0,13.2400000000000,6.54900000000000,5.91800000000000,1,-4.43500000000000,-2.19400000000000,-1.98300000000000,-0.335000000000000];

% Psi matrix
psi = [400,0,320;0,-400,240;0,0,1];

% Singular value decomposition
[UU SS VV] = svd(Q);

% Extract Gcw by reshaping last column of VV
sz = size(VV);
vv = VV(:,sz(2));
Gcw = (reshape(vv, 4, 3))';

% Comput Rwc and Twc
Rwc = Gcw(1:3,1:3)';
Twc = - Rwc * Gcw(1:3,end);

% Print out values
fprintf('Rotation matrix Rwc:\n');
disp(Rwc);

fprintf('Translation vector Twc:\n');
disp(Twc);

% Calculate real projection from point in world
qfindW = [14.3423181854615;4.38556290697137;3.07246344912662;1];
rProb = psi * Gcw * qfindW;
rProb = rProb./rProb(3);
rProb = rProb(1:2);
fprintf('Point q projects to:\n');
disp(rProb);

fprintf('Which is closest to coordinate:\n');
rPts = [492,376,633,380;276,249,9,216];
dist = sqrt((rProb(1) - rPts(1,:)).^2 + (rProb(2) - rPts(2,:)).^2);
[m, i] = min(dist);
disp(rPts(1:2,i));